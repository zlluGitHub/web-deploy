(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-796bdf3a"],{"6d05":function(t,e,a){"use strict";a("a54c")},a54c:function(t,e,a){},d1c1:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"swd-commit"},[a("div",{staticClass:"header"},[a("Decorate",{attrs:{icon:"ivu-icon ivu-icon-ios-list-box-outline",title:"构建列表（"+t.projectData.title+"）",describe:"这里将展示你的个人项目，当然也包括协同项目。"}})],1),a("div",{staticClass:"breadcrumb"},[a("div",{staticClass:"warp"},[a("Breadcrumb",[a("BreadcrumbItem",{attrs:{to:"/"}},[a("Icon",{attrs:{type:"ios-home-outline",size:"18"}}),t._v(" 工作台 ")],1),a("BreadcrumbItem",[a("Icon",{attrs:{type:"ios-list-box-outline",size:"18"}}),t._v(" "+t._s("构建列表（"+t.projectData.title+"）")+" ")],1)],1),a("div",{staticClass:"go-back",on:{click:function(e){return t.$router.go(-1)}}},[a("Icon",{attrs:{type:" fa fa-share-square-o",size:"15"}}),a("span",[t._v("返回上一页")])],1)],1)]),a("div",{staticClass:"content"},[a("div",[a("Table",{attrs:{border:"",columns:t.columns,data:t.content},scopedSlots:t._u([{key:"type",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$store.state.typeMap[a.activeType]||"未知")+" ")]}},{key:"deploy",fn:function(e){var o=e.row;return[o.bid===t.projectData.commitBid?a("p",{staticClass:"deploy-state"},[a("i",{staticClass:"ok"}),a("span",[t._v("已部署")])]):a("p",{staticClass:"deploy-state"},[a("i",{staticClass:"no"}),a("span",[t._v("未部署")])])]}},{key:"fileChange",fn:function(e){var o=e.row;return[o.isExit?a("p",{staticClass:"file-change"},[a("span",[t._v("修改"),a("em",[t._v(t._s(o.modified.length))]),t._v("个、 ")]),a("span",[t._v("新增"),a("em",[t._v(t._s(o.added.length))]),t._v("个、 ")]),a("span",[t._v("刪除"),a("em",[t._v(t._s(o.removed.length))]),t._v("个 ")])]):a("p",{staticClass:"file-change"},[a("span",[t._v("修改"),a("em",[t._v("☀")]),t._v("个、 ")]),a("span",[t._v("新增"),a("em",[t._v("☀")]),t._v("个、 ")]),a("span",[t._v("刪除"),a("em",[t._v("☀")]),t._v("个 ")])])]}},{key:"remark",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.remark?a.remark:"暂无描述")+" ")]}},{key:"progress",fn:function(e){var o=e.row;return[a("Progress",{attrs:{percent:o.progress,"stroke-width":6,status:t.statusMap[o.tip]||"active"}},[o.tip?a("span",[t._v(t._s(o.progress)+"%")]):t._e()])]}},{key:"action",fn:function(e){var o=e.row;return[a("div",{staticClass:"button-action"},[o.bid!=t.projectData.commitBid||100!=o.progress?a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleInitReset(o)}}},[t._v(" 部署 ")]):t._e(),a("Button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.getLogData(o)}}},[t._v("日志")]),o.file&&o.file.url?a("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.handleUrl(o)}}},[t._v("变动")]):t._e(),o.bid!=t.projectData.commitBid||"1"!=t.projectData.type&&"2"!=t.projectData.type&&!t.projectData.href.host?t._e():a("Button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.handleToUrl(t.projectData)}}},[t._v(" 访问 ")])],1)]}}])}),a("div",{staticClass:"page"},[a("Page",{attrs:{"prev-text":"上一页","next-text":"下一页","show-elevator":"","show-total":"",total:t.total,"show-sizer":""},on:{"on-change":t.changePage,"on-page-size-change":t.changeSizePage}})],1)],1)])])},n=[],i=a("5530"),s=(a("d81d"),a("fb6a"),a("99af"),a("20d6")),r={components:{Decorate:s["a"]},data:function(){return{pageNo:1,pageSize:10,total:10,statusMap:{"失败":"wrong","成功":"success"},socketData:[],columns:[{title:"构建方式",slot:"type",width:120},{title:"构建情况",width:255,slot:"fileChange"},{title:"构建时间",width:170,key:"startTime"},{title:"构建时长",width:140,key:"duration"},{title:"部署状态",slot:"deploy",width:100},{title:"构建描述",slot:"remark"},{title:"构建进度",slot:"progress"},{title:"操作",slot:"action",width:200}],content:[],projectData:{}}},created:function(){var t=this;this.handleGetData(),this.handleGetProject(),this.$mitt.on("on-log-modal-close",this.handleOnClose),this.$nextTick((function(){t.$mitt.emit("full-loading",!1)}))},methods:{handleOnClose:function(){this.handleGetData(),this.handleGetProject()},handleGetProject:function(){var t=this;this.$request.get("/wd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){200===e.data.code&&(t.projectData=e.data.data)}))},handleGetData:function(){var t=this,e={pageNo:this.pageNo,pageSize:this.pageSize,projectId:this.$route.query.bid};this.$request.get("/wd/commit/get",{params:e}).then((function(e){200===e.data.code&&(t.total=e.data.count,t.content=e.data.data.map((function(t){var e=new Date(t.startTime),a=new Date(t.endTime);return t.duration="共耗时："+Math.floor((a-e)/1e3)+"秒",t.hookPayload&&(t=Object(i["a"])(Object(i["a"])({},t),t.hookPayload),t.added=t.added?t.added:[],t.modified=t.modified?t.modified:[],t.removed=t.removed?t.removed:[]),t})))}))},getLogData:function(t){var e=this;this.$request.get("/wd/file/content",{params:{bid:t.bid,projectId:t.projectId}}).then((function(t){200===t.data.code&&e.$mitt.emit("on-log-modal",{type:"log",content:t.data.data})}))},changePage:function(t){this.pageNo=t,this.handleGetData()},changeSizePage:function(t){this.pageSize=t,this.pageNo=1,this.handleGetData()},handleUrl:function(t){var e=window.open();e.opener=null,e.location=t.url||this.projectData.git.slice(0,-4),e.target="_blank"},handleInitReset:function(t){var e=this;this.$Modal.confirm({title:"操作提示",content:"<p>确定要重新部署该版本吗？</p>",onOk:function(){e.user=e.$session.getItem("userInfo")||{},e.$mitt.emit("on-log-modal",{bid:e.user.bid,type:"init",callBack:function(){console.log("socket连接成功"),e.$request.post("/wd/deploy/static",{bid:t.projectId,commitBid:t.bid})}})}})},handleToUrl:function(t){var e=window.open();if(e.opener=null,"1"==t.type||"2"==t.type)if(t.port)e.location="".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(t.port);else{var a=t.www.indexOf("/")+1;t.www=t.www.slice(a,t.www.length),e.location="".concat(window.location.origin,"/").concat(t.www,"/index.html")}else"3"!=t.type&&"4"!=t.type||(e.location=t.href.protocol+t.href.host);e.target="_blank"}},beforeDestroy:function(){this.$mitt.off("on-log-modal-close",this.handleOnClose)}},c=r,l=(a("6d05"),a("2877")),d=Object(l["a"])(c,o,n,!1,null,"343a2350",null);e["default"]=d.exports},d81d:function(t,e,a){"use strict";var o=a("23e7"),n=a("b727").map,i=a("1dde"),s=i("map");o({target:"Array",proto:!0,forced:!s},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);