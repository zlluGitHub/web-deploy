(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-260ea520"],{"10df":function(t,e,a){"use strict";a("e3c3")},"15e5":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"swd-commit"},[a("div",{staticClass:"header"},[a("Decorate",{attrs:{icon:"ivu-icon ivu-icon-ios-list-box-outline",title:"构建列表（"+t.projectData.title+"）",describe:"这里将展示你的个人项目，当然也包括协同项目。"}})],1),a("div",{staticClass:"breadcrumb"},[a("div",{staticClass:"warp"},[a("Breadcrumb",[a("BreadcrumbItem",{attrs:{to:"/"}},[a("Icon",{attrs:{type:"ios-home-outline",size:"18"}}),t._v(" 工作台 ")],1),a("BreadcrumbItem",[a("Icon",{attrs:{type:"ios-list-box-outline",size:"18"}}),t._v(" "+t._s("构建列表（"+t.projectData.title+"）")+" ")],1)],1),a("div",{staticClass:"go-back",on:{click:function(e){return t.$router.go(-1)}}},[a("Icon",{attrs:{type:" fa fa-share-square-o",size:"15"}}),t._v(" "),a("span",[t._v("返回上一页")])],1)],1)]),a("div",{staticClass:"content"},[a("div",[a("Table",{attrs:{border:"",columns:t.columns,data:t.content},scopedSlots:t._u([{key:"deploy",fn:function(e){var o=e.row;return[o.bid===t.projectData.commitBid?a("p",{staticClass:"deploy-state"},[a("i",{staticClass:"ok"}),a("span",[t._v("已部署")])]):a("p",{staticClass:"deploy-state"},[a("i",{staticClass:"no"}),a("span",[t._v("未部署")])])]}},{key:"structure",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.isExit?"Git 推送（"+a.activeType+"）":"手动推送（"+a.activeType+"）")+" ")]}},{key:"fileChange",fn:function(e){var o=e.row;return[o.isExit?a("p",{staticClass:"file-change"},[a("span",[t._v("修改"),a("em",[t._v(t._s(o.modified.length))]),t._v("个、 ")]),a("span",[t._v("新增"),a("em",[t._v(t._s(o.added.length))]),t._v("个、 ")]),a("span",[t._v("刪除"),a("em",[t._v(t._s(o.removed.length))]),t._v("个 ")])]):a("p",{staticClass:"file-change"},[a("span",[t._v("修改"),a("em",[t._v("☀")]),t._v("个、 ")]),a("span",[t._v("新增"),a("em",[t._v("☀")]),t._v("个、 ")]),a("span",[t._v("刪除"),a("em",[t._v("☀")]),t._v("个 ")])])]}},{key:"message",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.message?a.message:"暂无描述")+" ")]}},{key:"action",fn:function(e){var o=e.row;return[a("div",{staticClass:"button-action"},[o.bid!==t.projectData.commitBid&&"3"!==o.modeType?a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleInitReset(o)}}},[t._v("部署")]):t._e(),a("Button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.handleShowLog(o)}}},[t._v("日志")]),o.isExit?a("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.handleUrl(o)}}},[t._v("变动")]):t._e()],1)]}}])}),a("div",{staticClass:"page"},[a("Page",{attrs:{"prev-text":"上一页","next-text":"下一页","show-elevator":"","show-total":"",total:t.total,"show-sizer":""},on:{"on-change":t.changePage,"on-page-size-change":t.changeSizePage}})],1)],1)]),a("LogModal",{ref:"logModal",attrs:{socketData:t.socketData}})],1)},i=[],n=a("5530"),s=(a("d81d"),a("fb6a"),a("20d6")),c=a("a33d"),r={components:{Decorate:s["a"],LogModal:c["a"]},data:function(){return{pageNo:1,pageSize:10,total:10,isLogModal:!1,socketData:[],columns:[{title:"构建方式",slot:"structure",width:260},{title:"构建情况",slot:"fileChange"},{title:"构建时间",key:"startTime"},{title:"构建时长",width:150,key:"duration"},{title:"部署状态",slot:"deploy",width:150},{title:"构建描述",slot:"message"},{title:"操作",slot:"action",width:200}],content:[],projectData:{}}},created:function(){this.getProjectData(),this.handleGetData()},methods:{handleShowLog:function(t){this.$refs.logModal.isLogModal=!0,this.socketData=t.log},handleGetData:function(){var t=this,e={pageNo:this.pageNo,pageSize:this.pageSize,projectId:this.$route.query.bid};this.$request.get("/swd/commit/get",{params:e}).then((function(e){200===e.data.code&&(t.total=e.data.count,t.content=e.data.data.map((function(t){var e=new Date(t.startTime),a=new Date(t.endTime);return t.duration="共耗时："+Math.floor((a-e)/1e3)+"秒",t.hookPayload&&(t=Object(n["a"])(Object(n["a"])({},t),t.hookPayload),t.added=t.added?t.added:[],t.modified=t.modified?t.modified:[],t.removed=t.removed?t.removed:[]),t})))}))},getProjectData:function(){var t=this;this.$request.get("/swd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){200===e.data.code&&(t.projectData=e.data.data[0])}))},activeType:function(t){return"init"===t?"首次部署":"resetInit"===t?"重新部署":"install"===t?"依赖安装":"build"===t?"打包部署":"gitHook"===t?"自动部署":"static"===t?"静态部署":"gitHook"===t?"Git部署":"默认部署"},changePage:function(t){this.pageNo=t,this.handleGetData()},changeSizePage:function(t){this.pageSize=t,this.handleGetData()},handleUrl:function(t){var e=window.open();e.opener=null,e.location=t.isExit?t.url:this.projectData.git.slice(0,-4),e.target="_blank"},handleInitReset:function(t){var e=this;this.$Modal.confirm({title:"系统提示",content:"<p>确定要重新部署该版本吗？</p>",onOk:function(){e.createSocketServer((function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],e.$refs.logModal.isLogModal=!0,e.projectData.commitBid=t.bid,e.$request.post("/swd/deploy/deployReduction",e.projectData).then((function(t){200===t.data.code&&e.$Modal.success({title:"系统提示",content:"该版本已部署成功！"})}))}))}})},createSocketServer:function(t){var e=this;this.$request.post("/swd/deploy/openSocket").then((function(a){a.data.result&&(e.socket=new WebSocket("ws://".concat(location.hostname,":8001")),e.socket.onopen=function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],console.log("WebSocket open"),t()},e.socket.onmessage=function(t){e.socketData.push({message:t.data,time:e.$dateTime()}),console.log("message: "+t.data)})}))}}},d=r,l=(a("10df"),a("2877")),u=Object(l["a"])(d,o,i,!1,null,"71034f33",null);e["default"]=u.exports},d81d:function(t,e,a){"use strict";var o=a("23e7"),i=a("b727").map,n=a("1dde"),s=n("map");o({target:"Array",proto:!0,forced:!s},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},e3c3:function(t,e,a){}}]);