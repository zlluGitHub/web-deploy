(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-650b7283"],{"21aa":function(t,e,s){},"258e":function(t,e,s){"use strict";s("d8dd")},"76e8":function(t,e,s){"use strict";s("77d8")},"77d8":function(t,e,s){},a25d:function(t,e,s){"use strict";s("21aa")},d001:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"swd-create"},[s("div",{staticClass:"header"},[s("Decorate",{attrs:{icon:"ivu-icon ivu-icon-md-add",title:"创建远程WEB项目",describe:"在这里可以创建一个新的项目，同时也可以迭代之前的项目。项目的创建分为手动部署与自动部署，可根据自身需求进行选择。"}},[s("div",{staticClass:"deploy-change"},[s("div",{staticClass:"but-item",class:["6"==t.modeType?"active":""],on:{click:function(e){return t.handleCharge("6")}}},[s("i",{staticClass:"ivu-icon ivu-icon-android-list"}),t._v(" 自动部署 ")]),s("div",{staticClass:"but-item",class:["5"==t.modeType?"active":""],on:{click:function(e){return t.handleCharge("5")}}},[s("i",{staticClass:"ivu-icon ivu-icon-gear-a"}),t._v("静态部署 ")])])])],1),s("div",{staticClass:"breadcrumb"},[s("div",{staticClass:"warp"},[s("Breadcrumb",[s("BreadcrumbItem",{attrs:{to:"/"}},[s("Icon",{attrs:{type:"ios-home-outline",size:"18"}}),t._v(" 工作台 ")],1),s("BreadcrumbItem",[s("Icon",{attrs:{type:"md-add",size:"18"}}),t._v(" 创建WEB项目 ")],1)],1),s("div",{staticClass:"go-back",on:{click:function(e){return t.$router.go(-1)}}},[s("Icon",{attrs:{type:" fa fa-share-square-o",size:"15"}}),t._v(" "),s("span",[t._v("返回上一页")])],1)],1)]),"6"==t.modeType?s("Gynamic"):t._e(),"5"==t.modeType?s("StaticIndex"):t._e()],1)},i=[],l=s("20d6"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("section",[s("div",{staticClass:"warp-box"},[s("div",[s("div",{staticClass:"list-item"},[t._m(0),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入项目名称..."},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"请填写项目名称。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(1),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：https://github.com/zlluGitHub/web-deploy.git"},model:{value:t.git.url,callback:function(e){t.$set(t.git,"url",e)},expression:"git.url"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"此处填写 gitLab 仓库地址。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(2),s("Input",{staticClass:"put-warp",attrs:{placeholder:"默认：master"},model:{value:t.git.branch,callback:function(e){t.$set(t.git,"branch",e)},expression:"git.branch"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"此处填写 gitLab 仓库分支，默认 master 主分支。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[s("label",[t._v(" 仓库状态：")]),s("Select",{staticClass:"put-warp",model:{value:t.ckType,callback:function(e){t.ckType=e},expression:"ckType"}},t._l([{label:"公共仓库",value:"ggck"},{label:"私有仓库",value:"syck"}],(function(e){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"若为公共仓库则不需要设置账号密码。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),"syck"===t.ckType?s("div",{staticClass:"list-item"},[t._m(3),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入用户名..."},model:{value:t.git.username,callback:function(e){t.$set(t.git,"username",e)},expression:"git.username"}})],1):t._e(),"syck"===t.ckType?s("div",{staticClass:"list-item"},[t._m(4),s("Input",{staticClass:"put-warp",attrs:{type:"password",placeholder:"请输入登录密码...'"},model:{value:t.git.password,callback:function(e){t.$set(t.git,"password",e)},expression:"git.password"}})],1):t._e(),s("div",{staticClass:"list-item"},[t._m(5),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：npm install"},model:{value:t.install,callback:function(e){t.install=e},expression:"install"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"填写项目依赖安装指令，支持 npm 和 cnpm 指令。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(6),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：npm run build"},model:{value:t.build,callback:function(e){t.build=e},expression:"build"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"填写项目打包指令，支持 npm 和 cnpm 指令。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(7),s("Input",{staticClass:"put-warp",attrs:{placeholder:"默认：dist"},model:{value:t.dist,callback:function(e){t.dist=e},expression:"dist"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"此处填写此项目的打包目录。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[s("label",[t._v("部署摘要：")]),s("Input",{staticClass:"put-warp",attrs:{type:"textarea",rows:4,placeholder:"请输入概要内容...'"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)]),s("div",[s("div",{staticClass:"list-item"},[t._m(8),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：/data/www/dist"},model:{value:t.www,callback:function(e){t.www=e},expression:"www"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"指部署到服务器上的路径，也就是项目存放路径。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(9),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：127.0.0.1"},model:{value:t.sshServer.host,callback:function(e){t.$set(t.sshServer,"host",e)},expression:"sshServer.host"}})],1),s("div",{staticClass:"list-item"},[t._m(10),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入概要内容..."},model:{value:t.sshServer.port,callback:function(e){t.$set(t.sshServer,"port",e)},expression:"sshServer.port"}})],1),s("div",{staticClass:"list-item"},[s("label",[t._v(" 登录方式：")]),s("Select",{staticClass:"put-warp",model:{value:t.loginType,callback:function(e){t.loginType=e},expression:"loginType"}},t._l([{label:"账号密码方式",value:"zm"},{label:"SSH秘钥方式",value:"ssh"}],(function(e){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),"zm"===t.loginType?s("div",{staticClass:"list-item"},[t._m(11),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入用户名..."},model:{value:t.sshServer.username,callback:function(e){t.$set(t.sshServer,"username",e)},expression:"sshServer.username"}})],1):t._e(),"zm"===t.loginType?s("div",{staticClass:"list-item"},[t._m(12),s("Input",{staticClass:"put-warp",attrs:{type:"password",placeholder:"请输入登录密码...'"},model:{value:t.sshServer.password,callback:function(e){t.$set(t.sshServer,"password",e)},expression:"sshServer.password"}})],1):t._e(),"ssh"===t.loginType?s("div",{staticClass:"list-item"},[t._m(13),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入秘钥...'"},model:{value:t.sshServer.privateKey,callback:function(e){t.$set(t.sshServer,"privateKey",e)},expression:"sshServer.privateKey"}})],1):t._e(),s("div",{staticClass:"list-item"},[s("label",[t._v("等待时长：")]),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输登录等待时长（可不填）'"},model:{value:t.sshServer.readyTimeout,callback:function(e){t.$set(t.sshServer,"readyTimeout",e)},expression:"sshServer.readyTimeout"}})],1)])]),s("div",{staticClass:"button-footer"},[s("Button",{attrs:{type:"success",ghost:""},on:{click:t.handleAutoSave}},[t._v(t._s(t.$route.query.bid?"更新部署":"开始部署"))]),s("Button",{on:{click:function(e){return e.stopPropagation(),t.handleBack(e)}}},[t._v("返回首页")])],1)]),s("LogModal",{ref:"logModal",attrs:{socketData:t.socketData},on:{"on-close":t.handleBack}})],1)},n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("项目名称： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("Git 地址： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("项目分支： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("Git账号：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("Git密码：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("安装依赖： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("打包命令： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("打包目录： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("部署路径： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("远程 IP：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("端口号：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("用户名：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("登录密码：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("SSH秘钥：")])}],o=(s("99af"),s("f971")),c=s("a33d"),d={components:{Decorate:l["a"],DeployTip:o["a"],LogModal:c["a"]},data:function(){return{socket:null,socketData:[],disabled:!!this.$route.query.bid,title:"",ckType:"ggck",bid:"",www:"",dist:"",remark:"",commitBid:"",git:{url:"",branch:"master",password:"",username:""},build:"npm run build",install:"cnpm i",loginType:"zm",sshServer:{host:"",password:"",privateKey:"",username:"",readyTimeout:null,port:22}}},watch:{ckType:function(t){"ggck"===t&&(this.git.username="",this.git.password="")}},created:function(){var t=this;this.$route.query.bid&&this.$request.get("/swd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){if(200===e.data.code){var s=e.data.data[0];t.title=s.title,t.gzip=s.gzip,t.dist=s.dist,t.remark=s.remark,t.git=s.git?s.git:{url:"",branch:"master",password:"",username:""},t.www=s.www,t.build=s.build,t.install=s.install,t.commitBid=s.commitBid,t.sshServer=s.sshServer,t.git.username&&t.git.password&&(t.ckType="syck")}}))},methods:{handleAutoSave:function(){this.title?this.www?this.git.url?this.git.branch?this.install?this.build?this.dist?this.sshServer.host?this.sshServer.port?this.handleAutoSubmit("save"):this.$Modal.warning({title:"系统提示",content:"远程端口号不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"远程IP不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"打包目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"打包命令不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"安装依赖命令不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目分支不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"Git 地址不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"部署目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目名称不得为空，请输入后再试！"})},handleAutoSubmit:function(t){var e=this,s={title:this.title,www:this.www,sshServer:this.sshServer,git:this.git,build:this.build,install:this.install,dist:this.dist,remark:this.remark,commitBid:this.commitBid,isStatic:"6"};this.$route.query.bid&&(s.bid=this.$route.query.bid),this.$Message.loading({content:"正在部署中，请稍后...",duration:0}),this.createSocketServer((function(){e.$refs.logModal.isLogModal=!0,e.$request.post("/swd/deploy/initRemote",s).then((function(t){e.$Message.destroy(),200===t.data.code&&(e.socketData.push({message:t.data.message,time:e.$dateTime()}),e.socketData.push({message:"部署Key："+t.data.data.bid,time:e.$dateTime()}),e.$Modal.success({title:"系统提示",content:"<div><p>".concat(e.title,"项目已部署到远程服务器，可打开对应地址访问！</p><p>部署Key：").concat(t.data.data.bid,"</p></div>")}),e.bid=t.data.data.bid)}))}))},handleBack:function(){this.$router.push({path:"/"})},createSocketServer:function(t){var e=this;this.$request.post("/swd/deploy/openSocket").then((function(s){s.data.result&&(e.socket=new WebSocket("ws://".concat(location.hostname,":8001")),e.socket.onopen=function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],t()},e.socket.onmessage=function(t){e.socketData.push({message:t.data,time:e.$dateTime()})})}))}}},u=d,p=(s("76e8"),s("2877")),h=Object(p["a"])(u,r,n,!1,null,"2f6cd640",null),m=h.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("section",[s("div",{staticClass:"warp-box"},[s("div",[s("div",{class:["list-item",t.isProjectExit?"ivu-form-item-error":""]},[t._m(0),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入项目名称..."},on:{"on-blur":t.handleIsProjectExit},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"请填写项目名称。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.isProjectExit?s("span",{staticClass:"isExNo"},[t._v("此项目已存在，请重新输入！")]):t._e()],1)],1),s("div",{staticClass:"list-item"},[s("label",[t._v("选择文件：")]),s("div",{staticClass:"put-warp file-warp"},[s("div",{staticClass:"file-top"},[s("Upload",{staticClass:"upload-but",attrs:{multiple:"",type:"drag","show-upload-list":!1,"before-upload":t.handleBeforeUpload,action:"/"}},[t._v(" 请选择文件 ")]),s("Upload",{staticClass:"upload-but",attrs:{multiple:"",webkitdirectory:"",type:"drag",action:"/","show-upload-list":!1,"before-upload":t.handleBeforeUpload}},[t._v(" 请选择文件夹 ")])],1),0===t.file.length?s("div",{staticClass:"file-bottom not-warp"},[s("div",[s("Icon",{attrs:{type:"ios-folder-open-outline"}})],1),s("p",[t._v("暂无文件")])]):t._e(),t.update&&0!==t.file.length?s("ul",{staticClass:"file-bottom"},t._l(t.file,(function(e,a){return s("li",{key:a},[s("span",[s("Icon",{attrs:{type:"ios-paper-outline"}}),s("span",{staticClass:"name"},[t._v(t._s(e.webkitRelativePath?e.webkitRelativePath:e.name))])],1),s("span",[e.state?s("span",{style:{color:"#19be6b"}},[t._v("上传成功")]):s("span",[t._v("等待上传")]),s("i",{staticClass:"fa fa-close",on:{click:function(e){return t.handleDeleteFile(a)}}})])])})),0):t._e()])]),s("div",{staticClass:"list-item"},[s("label",[t._v("部署摘要：")]),s("Input",{staticClass:"put-warp",attrs:{type:"textarea",rows:4,placeholder:"请输入概要内容...'"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)]),s("div",[s("div",{staticClass:"list-item"},[t._m(1),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：/data/www/dist"},model:{value:t.www,callback:function(e){t.www=e},expression:"www"}}),s("div",{staticClass:"tip"},[s("Tooltip",{attrs:{"max-width":"200",content:"指部署到服务器上的路径，也就是项目存放路径。",placement:"right"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),s("div",{staticClass:"list-item"},[t._m(2),s("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：127.0.0.1"},model:{value:t.sshServer.host,callback:function(e){t.$set(t.sshServer,"host",e)},expression:"sshServer.host"}})],1),s("div",{staticClass:"list-item"},[t._m(3),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入概要内容..."},model:{value:t.sshServer.port,callback:function(e){t.$set(t.sshServer,"port",e)},expression:"sshServer.port"}})],1),s("div",{staticClass:"list-item"},[s("label",[t._v(" 登录方式：")]),s("Select",{staticClass:"put-warp",model:{value:t.loginType,callback:function(e){t.loginType=e},expression:"loginType"}},t._l([{label:"账号密码方式",value:"zm"},{label:"SSH秘钥方式",value:"ssh"}],(function(e){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),"zm"===t.loginType?s("div",{staticClass:"list-item"},[t._m(4),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入用户名..."},model:{value:t.sshServer.username,callback:function(e){t.$set(t.sshServer,"username",e)},expression:"sshServer.username"}})],1):t._e(),"zm"===t.loginType?s("div",{staticClass:"list-item"},[t._m(5),s("Input",{staticClass:"put-warp",attrs:{type:"password",placeholder:"请输入登录密码...'"},model:{value:t.sshServer.password,callback:function(e){t.$set(t.sshServer,"password",e)},expression:"sshServer.password"}})],1):t._e(),"ssh"===t.loginType?s("div",{staticClass:"list-item"},[t._m(6),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入秘钥...'"},model:{value:t.sshServer.privateKey,callback:function(e){t.$set(t.sshServer,"privateKey",e)},expression:"sshServer.privateKey"}})],1):t._e(),s("div",{staticClass:"list-item"},[s("label",[t._v("等待时长：")]),s("Input",{staticClass:"put-warp",attrs:{placeholder:"请输登录等待时长（可不填）'"},model:{value:t.sshServer.readyTimeout,callback:function(e){t.$set(t.sshServer,"readyTimeout",e)},expression:"sshServer.readyTimeout"}})],1)])]),s("div",{staticClass:"button-footer"},[s("Button",{attrs:{type:"success",ghost:""},on:{click:t.handleAutoSave}},[t._v("提交部署")]),s("Button",{on:{click:function(e){return e.stopPropagation(),t.handleBack(e)}}},[t._v("返回首页")])],1)]),s("LogModal",{ref:"logModal",attrs:{socketData:t.socketData},on:{"on-close":t.handleClose}})],1)},f=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("项目名称： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("部署路径： ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("远程 IP：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("端口号：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("用户名：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("登录密码：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",[s("i",{staticClass:"star"},[t._v("*")]),t._v("SSH秘钥：")])}],w=(s("a434"),s("159b"),s("ac1f"),s("1276"),s("fb6a"),s("a15b"),s("b0c0"),s("c4e3")),b={components:{Decorate:l["a"],DeployTip:o["a"],LogModal:c["a"]},data:function(){return{file:[],loadingStatus:!1,update:!0,fileNumber:0,disabled:!!this.$route.query.bid,bid:"",isProjectExit:!1,isWwwExit:!1,isLogModal:!1,sideList:["已连接到应用服务器，正在部署..."],socket:null,socketData:[],portMessage:{},title:"",commitBid:"",www:"",remark:"",loginType:"zm",sshServer:{host:"",password:"",privateKey:"",username:"",readyTimeout:null,port:22}}},created:function(){var t=this;this.$route.query.bid&&(this.bid=this.$route.query.bid,this.$request.get("/swd/deploy/get",{params:{bid:this.bid}}).then((function(e){if(200===e.data.code){var s=e.data.data[0];t.title=s.title,t.isServer=s.isServer,t.remark=s.remark,t.www=s.www,t.sshServer=s.sshServer,t.commitBid=s.commitBid,t.router=s.router}})))},methods:{handleClose:function(){this.$router.push({path:"/"})},handleAutoSave:function(){this.title?this.www?(this.$route.query.bid,this.handleAutoSubmit()):this.$Modal.warning({title:"系统提示",content:"部署目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目名称不得为空，请输入后再试！"})},handleBeforeUpload:function(t){return t.state=!1,this.file.push(t),!1},handleDeleteFile:function(t){this.file.splice(t,1)},handleResetData:function(){this.title="",this.www="",this.port="",this.gzip=!0,this.remark="",this.router="history",this.proxy=[{rewrite:"",target:""}],this.file=[]},handleAutoSubmit:function(){var t=this,e={title:this.title,www:this.www,isServer:this.isServer,remark:this.remark,sshServer:this.sshServer,isStatic:"5"};this.$Message.loading({content:"正在构建中，请稍后...",duration:0}),this.createSocketServer((function(){t.$refs.logModal.isLogModal=!0,e.bid=t.$route.query.bid,t.$request.post("/swd/deploy/initStaticRemote",e).then((function(e){if(200===e.data.code)if(t.commitBid=e.data.data.commitBid,t.bid=e.data.data.bid,t.file.length>10)var s=setTimeout((function(){t.$Modal.confirm({title:"系统提示",content:"<p>检测到文件个数过多，是否进行压缩打包上传？</p>",onOk:function(){t.handleUploadZip()},onCancel:function(){t.handleAddFile()}}),clearTimeout(s)}),500);else t.handleAddFile();else t.$Message.destroy()})).catch((function(){t.$Message.destroy()}))}))},handleUploadZip:function(){var t=this;this.socketData.push({message:"The uploaded file is being compressed and packaged. Please wait...",time:this.$dateTime()});var e=new w;this.file.forEach((function(t){var s=t.webkitRelativePath.split("/");if(s.length>2){s=s.slice(1,s.length-1);var a=e.folder(s.join("/"));a.file(t.name,t)}else e.file(t.name,t)})),e.generateAsync({type:"Blob",compression:"DEFLATE"}).then((function(e){t.socketData.push({message:"The file has been compressed successfully and is being uploaded. Please wait...",time:t.$dateTime()});var s=new FormData;s.append("file",e),t.$request.post("/swd/fileEdit/saveZip",s,{headers:{"www-name":t.www,"commit-bid":t.commitBid,"project-bid":t.bid,"is-static":"5"}}).then((function(e){t.socketData.push({message:"压缩文件已上传成功！",time:t.$dateTime()}),t.deployReduction()})).catch((function(){t.$Message.destroy()}))}))},handleAddFile:function(){var t=this;this.file&&0!==this.file.length?(this.fileNumber=0,this.file.forEach((function(e,s){var a=new FormData;a.append("file",e,e.name),t.$request.post("/swd/fileEdit/saveFile",a,{headers:{"www-name":t.www,"commit-bid":t.commitBid,"is-static":"5","project-bid":t.bid,webkitRelativePath:e.webkitRelativePath}}).then((function(a){200===a.data.code?(e.state=!0,t.update=!1,t.update=!0,t.socketData.push({message:e.name+"文件上传保存成功！",time:t.$dateTime()})):(t.$Message.destroy(),t.socketData.push({message:e.name+"文件上传保存失败！",time:t.$dateTime()})),t.deployIsSesses(s)})).catch((function(a){t.$Message.destroy(),t.socketData.push({message:e.name+"文件上传保存失败！",time:t.$dateTime()}),t.deployIsSesses(s)}))}))):(this.$Message.destroy(),this.$Modal.success({title:"系统提示",content:this.title+"项目部署信息更新成功！"}),this.socketData.push({message:this.title+"项目部署信息更新成功！",time:this.$dateTime()}))},deployIsSesses:function(){this.fileNumber===this.file.length-1?this.deployReduction():this.fileNumber++},deployReduction:function(){var t=this,e={title:this.title,www:this.www,bid:this.bid,commitBid:this.commitBid,sshServer:this.sshServer,isStatic:"5"};this.$request.post("/swd/deploy/deployReduction",e).then((function(e){t.$Message.destroy(),200===e.data.code?(t.$Modal.success({title:"系统提示",content:t.title+"项目部署成功！"}),t.socketData.push({message:t.title+"项目部署成功！",time:t.$dateTime()})):t.$Message.destroy()}))},handleBack:function(){this.$router.push({path:"/"})},createSocketServer:function(t){var e=this;this.$request.post("/swd/deploy/openSocket").then((function(s){s.data.result&&(e.socket=new WebSocket("ws://".concat(location.hostname,":8001")),e.socket.onopen=function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],t()},e.socket.onmessage=function(t){e.socketData.push({message:t.data,time:e.$dateTime()})})}))}}},_=b,g=(s("258e"),Object(p["a"])(_,v,f,!1,null,"57df8528",null)),y=g.exports,k={components:{Decorate:l["a"],Gynamic:m,StaticIndex:y},data:function(){return{modeType:"6"}},created:function(){this.modeType=this.$route.query.isStatic?this.$route.query.isStatic:"6"},methods:{handleCharge:function(t){this.modeType=t}}},C=k,$=(s("a25d"),Object(p["a"])(C,a,i,!1,null,"6de9822c",null));e["default"]=$.exports},d8dd:function(t,e,s){}}]);