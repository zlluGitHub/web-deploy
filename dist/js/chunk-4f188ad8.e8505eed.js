(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f188ad8"],{"03bb":function(t,e,a){"use strict";a("baef")},2906:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"swd-create"},[a("div",{staticClass:"header"},[a("Decorate",{attrs:{icon:"ivu-icon ivu-icon-md-add",title:"创建WEB项目",describe:"在这里可以创建一个新的项目，同时也可以迭代之前的项目。项目的创建分为静态部署与Git部署，可根据自身需求进行选择。"}},[a("div",{staticClass:"deploy-change"},[a("div",{staticClass:"but-item",class:["1"===t.modeType?"active":""],on:{click:function(e){return t.handleCharge("1")}}},[a("i",{staticClass:"ivu-icon ivu-icon-android-list"}),t._v(" Git部署 ")]),a("div",{staticClass:"but-item",class:["2"===t.modeType?"active":""],on:{click:function(e){return t.handleCharge("2")}}},[a("i",{staticClass:"ivu-icon ivu-icon-gear-a"}),t._v("静态部署 ")])])])],1),a("div",{staticClass:"breadcrumb"},[a("div",{staticClass:"warp"},[a("Breadcrumb",[a("BreadcrumbItem",{attrs:{to:"/"}},[a("Icon",{attrs:{type:"ios-home-outline",size:"18"}}),t._v(" 工作台 ")],1),a("BreadcrumbItem",[a("Icon",{attrs:{type:"md-add",size:"18"}}),t._v(" 创建WEB项目 ")],1)],1),a("div",{staticClass:"go-back",on:{click:function(e){return t.$router.go(-1)}}},[a("Icon",{attrs:{type:" fa fa-share-square-o",size:"15"}}),t._v(" "),a("span",[t._v("返回上一页")])],1)],1)]),"1"===t.modeType?a("Gynamic"):t._e(),"2"===t.modeType?a("StaticIndex"):t._e()],1)},i=[],o=a("20d6"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("section",[a("Form",{ref:"formRef",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":80},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{label:"项目名称",prop:"title"}},[a("Input",{attrs:{placeholder:"请输入项目名称"},model:{value:t.formValidate.title,callback:function(e){t.$set(t.formValidate,"title",e)},expression:"formValidate.title"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"请输入项目名称",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"部署目录",prop:"www"}},[a("Input",{attrs:{disabled:t.$route.query.bid,placeholder:"请输入部署目录"},model:{value:t.formValidate.www,callback:function(e){t.$set(t.formValidate,"www",e)},expression:"formValidate.www"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"指部署到服务器上的目录文件夹，也是根目录。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"部署端口",prop:"port"}},[a("Input",{attrs:{placeholder:"请输入部署端口"},model:{value:t.formValidate.port,callback:function(e){t.$set(t.formValidate,"port",e)},expression:"formValidate.port"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"项目运行端口号，若不填默认：本系统地址/部署目录/index.html",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"代理地址"}},[a("AutoProxy",{model:{value:t.formValidate.proxy,callback:function(e){t.$set(t.formValidate,"proxy",e)},expression:"formValidate.proxy"}})],1),a("FormItem",{attrs:{label:"Git 地址",prop:"git.url"}},[a("Input",{attrs:{placeholder:"例如：https://github.com/zlluGitHub/web-deploy.git"},model:{value:t.formValidate.git.url,callback:function(e){t.$set(t.formValidate.git,"url",e)},expression:"formValidate.git.url"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"此处填写 git 仓库地址。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"项目分支",prop:"git.branch"}},[a("Input",{attrs:{placeholder:"默认：master"},model:{value:t.formValidate.git.branch,callback:function(e){t.$set(t.formValidate.git,"branch",e)},expression:"formValidate.git.branch"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"此处填写 git仓库分支，默认 master 主分支。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"仓库状态"}},[a("Select",{staticClass:"put-warp",model:{value:t.formValidate.git.storeState,callback:function(e){t.$set(t.formValidate.git,"storeState",e)},expression:"formValidate.git.storeState"}},[a("Option",{key:"public",attrs:{value:"public"}},[t._v("公共仓库")]),a("Option",{key:"private",attrs:{value:"private"}},[t._v("私有仓库")])],1),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"若为公共仓库则不需要设置账号密码。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),"private"==t.formValidate.git.storeState?[a("FormItem",{attrs:{label:"Git账号",prop:"git.username"}},[a("Input",{attrs:{placeholder:"请输入登录账号"},model:{value:t.formValidate.git.username,callback:function(e){t.$set(t.formValidate.git,"username",e)},expression:"formValidate.git.username"}})],1),a("FormItem",{attrs:{label:"Git密码",prop:"git.password"}},[a("Input",{attrs:{placeholder:"请输入登录密码"},model:{value:t.formValidate.git.password,callback:function(e){t.$set(t.formValidate.git,"password",e)},expression:"formValidate.git.password"}})],1)]:t._e(),a("FormItem",{attrs:{label:"依赖安装",prop:"install"}},[a("Input",{attrs:{placeholder:"例如：npm install"},model:{value:t.formValidate.install,callback:function(e){t.$set(t.formValidate,"install",e)},expression:"formValidate.install"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"填写项目依赖安装指令，支持 npm 和 cnpm 指令。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"打包命令",prop:"build"}},[a("Input",{attrs:{placeholder:"例如：npm run build"},model:{value:t.formValidate.build,callback:function(e){t.$set(t.formValidate,"build",e)},expression:"formValidate.build"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"填写项目打包指令，支持 npm 和 cnpm 指令。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"打包目录",prop:"dist"}},[a("Input",{attrs:{placeholder:"默认：dist"},model:{value:t.formValidate.dist,callback:function(e){t.$set(t.formValidate,"dist",e)},expression:"formValidate.dist"}}),a("Tooltip",{staticClass:"tip",attrs:{"max-width":"230",content:"此处填写此项目的打包目录。",placement:"right"}},[a("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1),a("FormItem",{attrs:{label:"部署摘要",prop:"remark"}},[a("Input",{attrs:{type:"textarea",rows:4,placeholder:"请输入摘要内容"},model:{value:t.formValidate.remark,callback:function(e){t.$set(t.formValidate,"remark",e)},expression:"formValidate.remark"}})],1)],2),a("div",{staticClass:"button-footer"},[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit(!0)}}},[t._v(t._s(t.$route.query.bid?"重新部署":"开始部署"))]),t.$route.query.bid?a("Button",{attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.handleSubmit(!1)}}},[t._v("修改配置")]):t._e(),a("Button",{attrs:{type:"error"},on:{click:function(e){return e.stopPropagation(),t.handleReset.apply(null,arguments)}}},[t._v("重置")])],1),a("div",{staticClass:"tip-box"},[a("DeployTip")],1)],1)])},s=[],n=a("f971"),d=a("bb74"),c={components:{Decorate:o["a"],DeployTip:n["a"],AutoProxy:d["a"]},data:function(){var t=this,e=function(e,a,r){a&&t.port!=a?1*a?t.$request.post("/wd/deploy/portIsOccupied",{port:1*a}).then((function(t){200===t.data.code?1==t.data.data?r():r(new Error(t.data.message)):r(new Error("端口检测失败，请稍后再试！"))})).catch((function(){r(new Error("端口检测失败，请稍后再试！"))})):r(new Error("端口设置有误，请输入正整数！")):r()},a=function(e,a,r){a?t.www==a?r():"/"==a||a.indexOf("*")>-1||a.indexOf(".")>-1?r(new Error("目录中不得包含“*”或者“.”，并且不得为“/”")):t.$request.post("/wd/deploy/isWwwFolder",{www:a}).then((function(t){200===t.data.code?t.data.state?r(new Error(t.data.message)):r():r(new Error("根目录检测失败，请稍后再试！"))})).catch((function(){r(new Error("根目录检测失败，请稍后再试！"))})):r(new Error("请输入部署根目录！"))};return{port:null,www:null,formValidate:{git:{url:"",storeState:"public",branch:"master",password:"",username:""},dist:"dist",build:"npm run build",install:"cnpm i",proxy:[{rewrite:"",replace:"",target:""}]},ruleValidate:{www:{required:!0,validator:a,trigger:"blur"},"git.url":{required:!0,message:"请输入 Git 地址",trigger:"blur"},"git.branch":{required:!0,message:"请输入 Git 分支",trigger:"blur"},"git.username":{required:!0,message:"请输入 Git 用户名",trigger:"blur"},"git.password":{required:!0,message:"请输入 Git 登录密码",trigger:"blur"},dist:{required:!0,message:"请输入打包目录",trigger:"blur"},title:{required:!0,message:"请输入项目名称",trigger:"blur"},install:{required:!0,message:"请输入依赖安装命令",trigger:"blur"},build:{required:!0,message:"请输入打包命令",trigger:"blur"},port:{validator:e,trigger:"blur"}}}},created:function(){var t=this;this.$route.query.bid&&this.$request.get("/wd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){200===e.data.code&&(t.port=e.data.data.port,t.www=e.data.data.www,t.formValidate=e.data.data)}))},methods:{handleReset:function(){this.$refs.formRef.resetFields(),this.formValidate={git:{url:"",storeState:"public",branch:"master",password:"",username:""},dist:"dist",build:"npm run build",install:"cnpm i",proxy:[{rewrite:"",replace:"",target:""}]}},handleSubmit:function(t){var e=this;this.$refs.formRef.validate((function(a){if(a){var r=e.$session.getItem("userInfo")||{},i=e.formValidate;i.activeType="a",i.userId=r.bid;var o="/wd/deploy/create";e.$route.query.bid&&(i.bid=e.$route.query.bid,o="/wd/deploy/update"),i.isReset=t,i.type="1",e.$mitt.emit("on-log-modal",{bid:i.userId,type:"init",callBack:function(){e.$request.post(o,i).then((function(t){if(e.$Message.destroy(),200===t.data.code){var a=t.data.data.bid;e.$router.push({path:"/commitList",query:{bid:a,log:1}})}else e.$Modal.error({title:"系统提示",content:t.data.message})}))}})}}))}}},u=c,p=(a("a7ec"),a("2877")),m=Object(p["a"])(u,l,s,!1,null,"28c0f1ee",null),f=m.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("section",[a("Form",{ref:"formRef",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":80},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{label:"项目名称",prop:"title"}},[a("Input",{attrs:{placeholder:"请输入项目名称"},model:{value:t.formValidate.title,callback:function(e){t.$set(t.formValidate,"title",e)},expression:"formValidate.title"}})],1),a("FormItem",{attrs:{label:"部署目录",prop:"www"}},[a("Input",{attrs:{disabled:t.$route.query.bid,placeholder:"请输入部署目录"},model:{value:t.formValidate.www,callback:function(e){t.$set(t.formValidate,"www",e)},expression:"formValidate.www"}})],1),a("FormItem",{attrs:{label:"部署端口",prop:"port"}},[a("Input",{attrs:{placeholder:"请输入部署端口"},model:{value:t.formValidate.port,callback:function(e){t.$set(t.formValidate,"port",e)},expression:"formValidate.port"}})],1),a("FormItem",{attrs:{label:"代理地址"}},[a("AutoProxy",{model:{value:t.formValidate.proxy,callback:function(e){t.$set(t.formValidate,"proxy",e)},expression:"formValidate.proxy"}})],1),a("FormItem",{attrs:{label:"选择文件",prop:"remark"}},[a("div",{staticClass:"put-warp file-warp"},[a("div",{staticClass:"file-top"},[a("Upload",{staticClass:"upload-but",attrs:{multiple:"",type:"drag","show-upload-list":!1,"before-upload":t.handleBeforeUpload,action:"/"}},[t._v(" 请选择文件 ")]),a("Upload",{staticClass:"upload-but",attrs:{multiple:"",webkitdirectory:"",type:"drag",action:"/","show-upload-list":!1,"before-upload":t.handleBeforeUpload}},[t._v(" 请选择文件夹 ")])],1),0===t.file.length?a("div",{staticClass:"file-bottom not-warp"},[a("div",[a("Icon",{attrs:{type:"ios-folder-open-outline"}})],1),a("p",[t._v("暂无文件")])]):t._e(),0!==t.file.length?a("ul",{staticClass:"file-bottom"},t._l(t.file,(function(e,r){return a("li",{key:r},[a("span",[a("Icon",{attrs:{type:"ios-paper-outline"}}),a("span",{staticClass:"name"},[t._v(t._s(e.webkitRelativePath?e.webkitRelativePath:e.name))])],1),a("span",[a("span",[t._v("等待上传")]),a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-close-circle-outline",size:"18"},on:{click:function(e){return t.handleDeleteFile(r)}}})],1)])})),0):t._e()])]),a("FormItem",{attrs:{label:"部署摘要",prop:"remark"}},[a("Input",{attrs:{type:"textarea",rows:4,placeholder:"请输入摘要内容"},model:{value:t.formValidate.remark,callback:function(e){t.$set(t.formValidate,"remark",e)},expression:"formValidate.remark"}})],1)],1),a("div",{staticClass:"button-footer"},[a("Button",{attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.handleSubmit.apply(null,arguments)}}},[t._v("开始部署")]),a("Button",{attrs:{type:"error"},on:{click:function(e){return e.stopPropagation(),t.handleReset.apply(null,arguments)}}},[t._v("重置")])],1)],1)])},h=[],w=(a("a434"),a("d3b7"),a("159b"),a("ac1f"),a("1276"),a("fb6a"),a("a15b"),a("b0c0"),a("c4e3")),g={components:{Decorate:o["a"],AutoProxy:d["a"]},data:function(){var t=this,e=function(e,a,r){a&&t.port!=a?1*a?t.$request.post("/wd/deploy/portIsOccupied",{port:1*a}).then((function(t){200===t.data.code?1==t.data.data?r():r(new Error(t.data.message)):r(new Error("端口检测失败，请稍后再试！"))})).catch((function(){r(new Error("端口检测失败，请稍后再试！"))})):r(new Error("端口设置有误，请输入正整数！")):r()},a=function(e,a,r){a?t.www==a?r():"/"==a||a.indexOf("*")>-1||a.indexOf(".")>-1?r(new Error("目录中不得包含“*”或者“.”，并且不得为“/”")):t.$request.post("/wd/deploy/isWwwFolder",{www:a}).then((function(t){200===t.data.code?t.data.state?r(new Error(t.data.message)):r():r(new Error("根目录检测失败，请稍后再试！"))})).catch((function(){r(new Error("根目录检测失败，请稍后再试！"))})):r(new Error("请输入部署根目录！"))};return{file:[],www:null,port:null,formValidate:{git:{url:"",storeState:"public",branch:"master",password:"",username:""},dist:"dist",proxy:[{rewrite:"",replace:"",target:""}]},ruleValidate:{www:{required:!0,validator:a,trigger:"blur"},title:{required:!0,message:"请输入项目名称",trigger:"blur"},port:{validator:e,trigger:"blur"}}}},created:function(){var t=this;this.user=this.$session.getItem("userInfo")||{},this.fileNumber=0,this.projectInfo={},this.$route.query.bid&&this.$request.get("/wd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){200===e.data.code&&(t.formValidate=e.data.data,t.port=e.data.data.port,t.www=e.data.data.www)}))},methods:{handleBeforeUpload:function(t){return t.state=!1,this.file.push(t),!1},handleDeleteFile:function(t){this.file.splice(t,1)},handleReset:function(){this.formValidate={},this.projectInfo={},this.file=[],this.$refs.formRef.resetFields()},handleSubmit:function(){var t=this;this.$refs.formRef.validate((function(e){if(e){var a=t.formValidate;a.type="2",a.activeType="c",a.userId=t.user.bid;var r="/wd/deploy/create";t.$route.query.bid&&(a.bid=t.$route.query.bid,r="/wd/deploy/update"),a.fileNumber=t.file.length,t.$mitt.emit("on-log-modal",{bid:a.userId,type:"init",callBack:function(){t.$request.post(r,a).then((function(e){200===e.data.code?(t.projectInfo=e.data.data,t.file.length>0?t.file.length>10?(t.$Message.loading({content:"文件个数过多，正在进行压缩上传，请稍后...",duration:0}),t.handleUploadZip()):t.handleAddFile():t.$request.post("/wd/deploy/updateStatic",t.projectInfo).then((function(e){200==e.data.code?t.$router.push({path:"/commitList",query:{bid:t.projectInfo.bid,log:1}}):t.$Modal.error({title:"系统提示",content:e.data.message})}))):t.$Modal.error({title:"系统提示",content:e.data.message})}))}})}}))},handleUploadZip:function(){var t=this,e=new w;this.file.forEach((function(t){var a=t.webkitRelativePath.split("/");if(a.length>2){a=a.slice(1,a.length-1);var r=e.folder(a.join("/"));r.file(t.name,t)}else e.file(t.name,t)})),e.generateAsync({type:"Blob",compression:"DEFLATE"}).then((function(e){var a=new FormData;a.append("file",e),t.$request.post("/wd/file/saveZip",a,{headers:{"commit-bid":t.projectInfo.commitBid,"project-bid":t.projectInfo.bid}}).then((function(e){var a=e.data.data.bid;t.$Message.destroy(),t.$router.push({path:"/commitList",query:{bid:a,log:1}})}))}))},handleAddFile:function(){var t=this;this.file.forEach((function(e){var a=new FormData;a.append("file",e,e.name),t.$request.post("/wd/file/saveFile",a,{headers:{"file-name":e.name,"file-number":t.file.length,"commit-bid":t.projectInfo.commitBid,"project-bid":t.projectInfo.bid,"user-bid":t.user.bid,webkitRelativePath:e.webkitRelativePath}})})),this.$router.push({path:"/commitList",query:{bid:this.projectInfo.bid,log:1}})}}},v=g,y=(a("fb53"),Object(p["a"])(v,b,h,!1,null,"0410570e",null)),I=y.exports,V={components:{Decorate:o["a"],Gynamic:f,StaticIndex:I},data:function(){return{modeType:"1"}},created:function(){var t=this;this.modeType=this.$route.query.type||"1",this.$nextTick((function(){t.$mitt.emit("full-loading",!1)}))},methods:{handleCharge:function(t){this.modeType=t}}},$=V,x=(a("03bb"),Object(p["a"])($,r,i,!1,null,"b00608f4",null));e["default"]=x.exports},7699:function(t,e,a){},"7839e":function(t,e,a){},a7ec:function(t,e,a){"use strict";a("7699")},baef:function(t,e,a){},fb53:function(t,e,a){"use strict";a("7839e")}}]);