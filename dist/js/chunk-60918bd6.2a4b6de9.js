(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60918bd6"],{"01e1":function(t,e,i){"use strict";i("9148")},"159b":function(t,e,i){var s=i("da84"),a=i("fdbc"),o=i("17c2"),r=i("9112");for(var n in a){var l=s[n],c=l&&l.prototype;if(c&&c.forEach!==o)try{r(c,"forEach",o)}catch(d){c.forEach=o}}},"17c2":function(t,e,i){"use strict";var s=i("b727").forEach,a=i("a640"),o=a("forEach");t.exports=o?[].forEach:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}},"1dde":function(t,e,i){var s=i("d039"),a=i("b622"),o=i("2d00"),r=a("species");t.exports=function(t){return o>=51||!s((function(){var e=[],i=e.constructor={};return i[r]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},"20d6":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"spots"},[i("span",{staticClass:"decorate",staticStyle:{background:"rgb(201, 27, 0)",width:"51px",height:"51px","margin-top":"-25.5px","margin-left":"-25.5px",top:"55.6675%",left:"5%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(23, 90, 171)",width:"28px",height:"28px","margin-top":"-14px","margin-left":"-14px",top:"10.2246%",left:"15%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(233, 34, 36)",width:"37px",height:"37px","margin-top":"-18.5px","margin-left":"-18.5px",top:"71.9133%",left:"25%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(0, 62, 135)",width:"47px",height:"47px","margin-top":"-23.5px","margin-left":"-23.5px",top:"22.8839%",left:"35%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(0, 135, 231)",width:"31px",height:"31px","margin-top":"-15.5px","margin-left":"-15.5px",top:"5.09172%",left:"45%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(23, 90, 171)",width:"52px",height:"52px","margin-top":"-26px","margin-left":"-26px",top:"32.1525%",left:"55%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(255, 86, 0)",width:"29px",height:"29px","margin-top":"-14.5px","margin-left":"-14.5px",top:"46.8035%",left:"65%"}}),i("span",{staticClass:"decorate",staticStyle:{width:"44px",height:"44px","margin-top":"-22px","margin-left":"-22px",top:"76.8537%",left:"75%"}}),i("span",{staticClass:"decorate",staticStyle:{background:"rgb(201, 27, 0)",width:"43px",height:"43px","margin-top":"-21.5px","margin-left":"-21.5px",top:"30.7088%",left:"85%"}}),i("span",{staticClass:"decorate",staticStyle:{width:"27px",height:"27px","margin-top":"-13.5px","margin-left":"-13.5px",top:"7.43497%",left:"95%"}}),i("div",{staticClass:"warp"},[i("div",{staticClass:"left"},[i("div",{staticClass:"logo"},[i("i",{class:t.icon})]),i("div",{staticClass:"info"},[i("h2",[t._v(t._s(t.title))]),i("p",[t._v(t._s(t.describe))])])]),t._t("default")],2)])},a=[],o={props:["icon","title","describe"]},r=o,n=(i("5c23"),i("2877")),l=Object(n["a"])(r,s,a,!1,null,"4c08b714",null);e["a"]=l.exports},2906:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"swd-create"},[i("div",{staticClass:"header"},[i("Decorate",{attrs:{icon:"ivu-icon ivu-icon-md-add",title:"创建项目",describe:"在这里可以创建一个新的项目，同时也可以迭代之前的项目。项目的创建分为静态部署与自动部署，可根据自身需求进行选择。"}},[i("div",{staticClass:"deploy-change"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"1"!==t.$route.query.isStatic,expression:"$route.query.isStatic !== '1'"}],staticClass:"but-item",class:["0"===t.modeType?"active":""],on:{click:function(e){return t.handleCharge("0")}}},[i("i",{staticClass:"ivu-icon ivu-icon-android-list"}),t._v(" 自动部署 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:"0"!==t.$route.query.isStatic,expression:"$route.query.isStatic !== '0'"}],staticClass:"but-item",class:["1"===t.modeType?"active":""],on:{click:function(e){return t.handleCharge("1")}}},[i("i",{staticClass:"ivu-icon ivu-icon-gear-a"}),t._v("静态部署 ")])])])],1),i("div",{staticClass:"breadcrumb"},[i("Breadcrumb",{staticClass:"warp"},[i("BreadcrumbItem",{attrs:{to:"/"}},[i("Icon",{attrs:{type:"ios-home-outline",size:"18"}}),t._v(" 工作台 ")],1),i("BreadcrumbItem",[i("Icon",{attrs:{type:"md-add",size:"18"}}),t._v(" 创建项目 ")],1)],1)],1),"0"===t.modeType?i("Gynamic"):t._e(),"1"===t.modeType?i("StaticIndex"):t._e()],1)},a=[],o=i("20d6"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("section",[i("div",{class:["list-item",t.isProjectExit?"ivu-form-item-error":""]},[t._m(0),i("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入项目名称..."},on:{"on-blur":t.handleIsProjectExit},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"请填写项目名称。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.isProjectExit?i("span",{staticClass:"isExNo"},[t._v("此项目已存在，请重新输入！")]):t._e()],1)],1),i("div",{class:["list-item",t.isWwwExit?"ivu-form-item-error":""]},[t._m(1),i("Input",{staticClass:"put-warp",attrs:{disabled:t.$route.query.bid,placeholder:"例如：dist"},on:{"on-blur":t.handleIsWwwExit},model:{value:t.www,callback:function(e){t.www=e},expression:"www"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"指部署到服务器上的目录，也就是一级目录。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.isWwwExit?i("span",{staticClass:"isExNo"},[t._v("此目录已存在，请重新输入！")]):t._e()],1)],1),i("div",{class:["list-item",t.portMessage.state?"ivu-form-item-error":""]},[t._m(2),i("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：8080 （选填）"},on:{"on-blur":t.handleIsPortExit},model:{value:t.port,callback:function(e){t.port=e},expression:"port"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"默认：本系统端口号/部署目录/index.html",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.portMessage.state?i("span",{staticClass:"isExNo"},[t._v(t._s(t.portMessage.message))]):t._e()],1)],1),i("div",{staticClass:"list-item"},[i("label",[t._v("代理地址：")]),i("ul",t._l(t.proxy,(function(e,s){return i("li",{key:"x"+s},[i("div",{staticClass:"put-warp proxy-warp"},[i("Input",{staticStyle:{width:"30%"},attrs:{placeholder:"例如：api"},model:{value:t.proxy[s].rewrite,callback:function(e){t.$set(t.proxy[s],"rewrite",e)},expression:"proxy[i].rewrite"}}),i("span",[t._v("-")]),i("Input",{attrs:{placeholder:"例如：http://127.0.0.1"},model:{value:t.proxy[s].target,callback:function(e){t.$set(t.proxy[s],"target",e)},expression:"proxy[i].target"}})],1),i("div",{staticClass:"tip"},[i("Icon",{attrs:{type:"ios-add-circle-outline"},on:{click:function(e){return e.stopPropagation(),t.handleAddProxy(e)}}}),t.proxy.length>1?i("Icon",{attrs:{type:"ios-close-circle-outline"},on:{click:function(e){return e.stopPropagation(),t.handleDeleteProxy(s)}}}):t._e()],1)])})),0)]),i("div",{staticClass:"list-item"},[t._m(3),i("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：http://10.0.86.12/zll/science.git"},model:{value:t.git,callback:function(e){t.git=e},expression:"git"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"此处填写 gitLab 仓库地址。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),i("div",{staticClass:"list-item"},[t._m(4),i("Input",{staticClass:"put-warp",attrs:{placeholder:"默认：master"},model:{value:t.branch,callback:function(e){t.branch=e},expression:"branch"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"此处填写 gitLab 仓库分支，默认 master 主分支。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),i("div",{staticClass:"list-item"},[t._m(5),i("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：npm install"},model:{value:t.install,callback:function(e){t.install=e},expression:"install"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"填写项目依赖安装指令，支持 npm 和 cnpm 指令。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),i("div",{staticClass:"list-item"},[t._m(6),i("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：npm run build"},model:{value:t.build,callback:function(e){t.build=e},expression:"build"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"填写项目打包指令，支持 npm 和 cnpm 指令。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),i("div",{staticClass:"list-item"},[t._m(7),i("Input",{staticClass:"put-warp",attrs:{placeholder:"默认：dist"},model:{value:t.dist,callback:function(e){t.dist=e},expression:"dist"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"此处填写此项目的打包目录。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)],1),i("div",{staticClass:"list-item"},[i("label",[t._v("部署摘要：")]),i("Input",{staticClass:"put-warp",attrs:{type:"textarea",rows:4,placeholder:"请输入概要内容...'"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),i("div",{staticClass:"tip-box"},[i("DeployTip")],1),i("div",{staticClass:"button-footer"},[i("Button",{attrs:{type:"success",ghost:""},on:{click:function(e){return t.handleAutoSubmit("deploy")}}},[t._v(t._s(t.$route.query.bid?"更新部署":"开始部署"))]),i("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){return e.stopPropagation(),t.handleAutoSave(e)}}},[t._v("提交保存")]),i("Button",{on:{click:function(e){return e.stopPropagation(),t.handleBack(e)}}},[t._v("返回首页")])],1)]),i("LogModal",{ref:"logModal",attrs:{socketData:t.socketData}})],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("项目名称： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("部署目录： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("部署端口：")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("Git 地址： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("项目分支： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("安装依赖： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("打包命令： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("打包目录： ")])}],l=(i("a434"),i("f971")),c=i("a33d"),d={components:{Decorate:o["a"],DeployTip:l["a"],LogModal:c["a"]},data:function(){return{modeType:"0",isProjectExit:!1,isWwwExit:!1,isLogModal:!1,sideList:["已连接到应用服务器，正在部署..."],socket:null,socketData:[],portMessage:{},queryTitle:"",queryWww:"",queryPort:"",title:"",www:"",port:"",proxy:[{rewrite:"",target:""}],dist:"",key:"",remark:"",git:"",branch:"master",build:"npm run build",install:"cnpm i",isServer:"",router:"history"}},created:function(){var t=this;this.$route.query.bid&&this.$request.get("/swd/deploy/get",{params:{bid:this.$route.query.bid}}).then((function(e){if(200===e.data.code){var i=e.data.data[0];t.queryPort=i.port,t.queryTitle=i.title,t.queryWww=i.www,t.title=i.title,t.proxy=i.proxy,t.dist=i.dist,t.remark=i.remark,t.git=i.git,t.www=i.www,t.port=i.port,t.key=i.key,t.branch=i.branch,t.build=i.build,t.install=i.install,t.commitBid=i.commitBid,t.isServer=i.isServer,t.router=i.router}}))},methods:{handleAutoSave:function(){var t=this;this.title?this.www?this.port?this.git?this.branch?this.install?this.build?this.dist?this.$Modal.confirm({title:"系统提示",content:"若修改端口或代理地址需要重启服务即可生效！",okText:"确定",cancelText:"取消",onOk:function(){t.handleAutoSubmit("save")}}):this.$Modal.warning({title:"系统提示",content:"打包目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"打包命令不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"安装依赖命令不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目分支不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"Git 地址不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"部署端口不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"部署目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目名称不得为空，请输入后再试！"})},handleAutoSubmit:function(t){var e=this,i={title:this.title,www:this.www,port:this.port,git:this.git,branch:this.branch?this.branch:"master",build:this.build,install:this.install,dist:this.dist,proxy:this.proxy,key:this.key,remark:this.remark,commitBid:this.commitBid,isServer:this.isServer,isStatic:"0",router:this.router};"deploy"===t?(this.$Message.loading({content:"正在部署中，请稍后...",duration:0}),this.createSocketServer((function(){e.$refs.logModal.isLogModal=!0,e.$route.query.bid?(i.bid=e.$route.query.bid,e.$request.post("/swd/deploy/initReset",i).then((function(t){e.$Message.destroy(),200===t.data.code&&(e.socketData.push({message:e.title+"项目部署成功！",time:e.$dateTime()}),e.$Modal.success({title:"系统提示",content:e.title+"项目部署成功！"}),e.$router.push({path:"/gynamicDetails",query:{bid:t.data.data}}))}))):e.$request.post("/swd/deploy/init",i).then((function(t){e.$Message.destroy(),200===t.data.code&&(e.socketData.push({message:e.title+"项目部署成功！",time:e.$dateTime()}),e.$Modal.success({title:"系统提示",content:e.title+"项目部署成功！"}),e.$router.push({path:"/gynamicDetails",query:{bid:t.data.data}}))}))}))):"save"===t&&(this.$route.query.bid?(i.bid=this.$route.query.bid,this.$request.post("/swd/deploy/updateInfo",i).then((function(t){200===t.data.code&&e.$router.push({path:"/gynamicDetails",query:{bid:i.bid}})}))):this.$request.post("/swd/deploy/saveInfo",i).then((function(t){200===t.data.code&&e.$router.push({path:"/gynamicDetails",query:{bid:t.data.data}})})))},handleIsPortExit:function(){var t=this;this.port&&(this.isIntNum(this.port)?this.$request.post("/swd/deploy/portIsOccupied",{port:this.port}).then((function(e){200===e.data.code&&(1===e.data.data||t.queryPort&&t.queryPort===t.port?t.portMessage={state:!1,message:e.data.message}:t.portMessage={state:!0,message:e.data.message})})):this.portMessage={state:!0,message:"端口设置有误，请输入正整数！"})},handleIsProjectExit:function(){var t=this;this.title&&this.$request.post("/swd/deploy/isProject",{title:this.title}).then((function(e){200===e.data.code&&(t.queryTitle?t.queryTitle!==t.title?t.isProjectExit=e.data.state:t.isProjectExit=!1:t.isProjectExit=e.data.state)}))},handleIsWwwExit:function(){var t=this;this.www&&this.$request.post("/swd/deploy/isWwwFolder",{title:this.title,www:this.www}).then((function(e){200===e.data.code&&(t.queryWww?t.queryWww!==t.www?t.isWwwExit=e.data.state:t.isWwwExit=!1:t.isWwwExit=e.data.state)}))},handleAddProxy:function(){this.proxy.push({rewrite:"",target:""})},handleDeleteProxy:function(t){this.proxy.length>0&&this.proxy.splice(t,1)},handleBack:function(){this.$router.push({path:"/"})},handleLoginModal:function(){window.sessionStorage.clear(),this.$store.commit("setUser",{}),this.$router.push({path:"/login"})},isIntNum:function(t){return!!(1*t)},createSocketServer:function(t){var e=this;this.$request.post("/swd/deploy/openSocket").then((function(i){i.data.result&&(e.socket=new WebSocket("ws://152.136.101.31:8001"),e.socket.onopen=function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],t()},e.socket.onmessage=function(t){e.socketData.push({message:t.data,time:e.$dateTime()})})}))}}},u=d,p=(i("d9a0"),i("2877")),h=Object(p["a"])(u,r,n,!1,null,"65570e66",null),m=h.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("section",[i("div",{class:["list-item",t.isProjectExit?"ivu-form-item-error":""]},[t._m(0),i("Input",{staticClass:"put-warp",attrs:{placeholder:"请输入项目名称..."},on:{"on-blur":t.handleIsProjectExit},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"请填写项目名称。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.isProjectExit?i("span",{staticClass:"isExNo"},[t._v("此项目已存在，请重新输入！")]):t._e()],1)],1),i("div",{class:["list-item",t.isWwwExit?"ivu-form-item-error":""]},[t._m(1),i("Input",{staticClass:"put-warp",attrs:{disabled:t.$route.query.bid,placeholder:"例如：dist"},on:{"on-blur":t.handleIsWwwExit},model:{value:t.www,callback:function(e){t.www=e},expression:"www"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"指部署到服务器上的目录，也就是一级目录。",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.isWwwExit?i("span",{staticClass:"isExNo"},[t._v("此目录已存在，请重新输入！")]):t._e()],1)],1),i("div",{class:["list-item",t.portMessage.state?"ivu-form-item-error":""]},[i("label",[t._v("部署端口：")]),i("Input",{staticClass:"put-warp",attrs:{placeholder:"例如：8080 （选填）"},on:{"on-blur":t.handleIsPortExit},model:{value:t.port,callback:function(e){t.port=e},expression:"port"}}),i("div",{staticClass:"tip"},[i("Tooltip",{attrs:{"max-width":"200",content:"默认：本系统端口号/部署目录/index.html",placement:"right"}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1),t.portMessage.state?i("span",{staticClass:"isExNo"},[t._v(t._s(t.portMessage.message))]):t._e()],1)],1),i("div",{staticClass:"list-item"},[i("label",[t._v("选择文件：")]),i("div",{staticClass:"put-warp file-warp"},[i("div",{staticClass:"file-top"},[i("Upload",{staticClass:"upload-but",attrs:{multiple:"",type:"drag","show-upload-list":!1,"before-upload":t.handleBeforeUpload,action:"/"}},[t._v(" 请选择文件 ")]),i("Upload",{staticClass:"upload-but",attrs:{multiple:"",webkitdirectory:"",type:"drag",action:"/","show-upload-list":!1,"before-upload":t.handleBeforeUpload}},[t._v(" 请选择文件夹 ")])],1),0===t.file.length?i("div",{staticClass:"file-bottom not-warp"},[i("div",[i("Icon",{attrs:{type:"ios-folder-open-outline"}})],1),i("p",[t._v("暂无文件")])]):t._e(),t.update&&0!==t.file.length?i("ul",{staticClass:"file-bottom"},t._l(t.file,(function(e,s){return i("li",{key:s},[i("span",[i("Icon",{attrs:{type:"ios-paper-outline"}}),i("span",{staticClass:"name"},[t._v(t._s(e.webkitRelativePath?e.webkitRelativePath:e.name))])],1),i("span",[e.state?i("span",{style:{color:"#19be6b"}},[t._v("上传成功")]):i("span",[t._v("等待上传")]),i("i",{staticClass:"fa fa-close",on:{click:function(e){return t.handleDeleteFile(s)}}})])])})),0):t._e()])]),i("div",{staticClass:"list-item"},[i("label",[t._v("部署摘要：")]),i("Input",{staticClass:"put-warp",attrs:{type:"textarea",rows:4,placeholder:"请输入概要内容...'"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),i("div",{staticClass:"button-footer"},[i("Button",{attrs:{type:"success",ghost:""},on:{click:t.handleAutoSave}},[t._v(t._s("提交部署"))]),t.$route.query.bid?t._e():i("Button",{attrs:{type:"error",ghost:""},on:{click:function(e){return e.stopPropagation(),t.handleResetData(e)}}},[t._v("重置")]),i("Button",{on:{click:function(e){return e.stopPropagation(),t.handleBack(e)}}},[t._v("返回首页")])],1)]),i("LogModal",{ref:"logModal",attrs:{socketData:t.socketData}})],1)},f=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("项目名称： ")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",[i("i",{staticClass:"star"},[t._v("*")]),t._v("部署目录： ")])}],v=(i("159b"),i("b0c0"),{components:{Decorate:o["a"],DeployTip:l["a"],LogModal:c["a"]},data:function(){return{file:[],loadingStatus:!1,update:!0,fileNumber:0,bid:"",isProjectExit:!1,isWwwExit:!1,isLogModal:!1,sideList:["已连接到应用服务器，正在部署..."],socket:null,socketData:[],portMessage:{},queryTitle:"",queryWww:"",queryPort:"",title:"",commitBid:"",www:"",port:"",remark:"",isServer:"",router:""}},created:function(){var t=this;this.$route.query.bid&&(this.bid=this.$route.query.bid,this.$request.get("/swd/deploy/get",{params:{bid:this.bid}}).then((function(e){if(200===e.data.code){var i=e.data.data[0];t.queryPort=i.port,t.queryTitle=i.title,t.queryWww=i.www,t.title=i.title,t.isServer=i.isServer,t.remark=i.remark,t.www=i.www,t.port=i.port,t.router=i.router}})))},methods:{handleAutoSave:function(){var t=this;this.title?this.www?this.$route.query.bid?this.$Modal.confirm({title:"系统提示",content:"若修改端口需要重启服务即可生效！",okText:"确定",cancelText:"取消",onOk:function(){t.handleAutoSubmit()}}):this.handleAutoSubmit():this.$Modal.warning({title:"系统提示",content:"部署目录不得为空，请输入后再试！"}):this.$Modal.warning({title:"系统提示",content:"项目名称不得为空，请输入后再试！"})},handleBeforeUpload:function(t){return t.state=!1,this.file.push(t),!1},handleDeleteFile:function(t){this.file.splice(t,1)},handleResetData:function(){this.title="",this.www="",this.port="",this.remark="",this.file=[]},handleAutoSubmit:function(t){var e=this,i={title:this.title,www:this.www,port:this.port,isServer:this.isServer,remark:this.remark,isStatic:"1"};this.$Message.loading({content:"正在构建中，请稍后...",duration:0}),this.createSocketServer((function(){e.$refs.logModal.isLogModal=!0,i.bid=e.$route.query.bid,e.$request.post("/swd/deploy/initStatic",i).then((function(t){200===t.data.code&&(e.commitBid=t.data.data.commitBid,e.bid=t.data.data.bid,e.handleAddFile())}))}))},handleAddFile:function(){var t=this;this.file&&0!==this.file.length?(this.fileNumber=0,this.file.forEach((function(e,i){var s=new FormData;s.append("file",e,e.name),t.$request.post("/swd/fileEdit/add",s,{headers:{"www-name":t.www,"commit-bid":t.commitBid,webkitRelativePath:e.webkitRelativePath}}).then((function(s){200===s.data.code?(e.state=!0,t.update=!1,t.update=!0,t.socketData.push({message:e.name+"文件上传保存成功！",time:t.$dateTime()})):t.socketData.push({message:e.name+"文件上传保存失败！",time:t.$dateTime()}),t.deployIsSesses(i)})).catch((function(s){t.socketData.push({message:e.name+"文件上传保存失败！",time:t.$dateTime()}),t.deployIsSesses(i)}))}))):(this.$Message.destroy(),this.$Modal.success({title:"系统提示",content:this.title+"项目部署成功！"}),this.socketData.push({message:this.title+"项目部署成功！",time:this.$dateTime()}),this.$router.push({path:"/staticIndexDetails",query:{bid:this.bid}}))},deployIsSesses:function(t){var e=this;if(this.fileNumber===this.file.length-1){var i={title:this.title,www:this.www,bid:this.bid,port:this.port,isServer:this.isServer,commitBid:this.commitBid};this.$request.post("/swd/deploy/deployReduction",i).then((function(t){e.$Message.destroy(),200===t.data.code&&(e.$Modal.success({title:"系统提示",content:e.title+"项目部署成功！"}),e.socketData.push({message:e.title+"项目部署成功！",time:e.$dateTime()}),e.$router.push({path:"/staticIndexDetails",query:{bid:e.bid}}))}))}else this.fileNumber++},handleIsPortExit:function(){var t=this;this.port&&(this.isIntNum(this.port)?this.$request.post("/swd/deploy/portIsOccupied",{port:this.port}).then((function(e){200===e.data.code&&(1===e.data.data||t.queryPort&&t.queryPort===t.port?t.portMessage={state:!1,message:e.data.message}:t.portMessage={state:!0,message:e.data.message})})):this.portMessage={state:!0,message:"端口设置有误，请输入正整数！"})},handleIsProjectExit:function(){var t=this;this.title&&this.$request.post("/swd/deploy/isProject",{title:this.title}).then((function(e){200===e.data.code?t.queryTitle?t.queryTitle!==t.title?t.isProjectExit=e.data.state:t.isProjectExit=!1:t.isProjectExit=e.data.state:t.isProjectExit=!1}))},handleIsWwwExit:function(){var t=this;this.www&&this.$request.post("/swd/deploy/isWwwFolder",{title:this.title,www:this.www}).then((function(e){200===e.data.code?t.queryWww?t.queryWww!==t.www?t.isWwwExit=e.data.state:t.isWwwExit=!1:t.isWwwExit=e.data.state:t.isWwwExit=!1}))},handleBack:function(){this.$router.push({path:"/"})},isIntNum:function(t){return!!(1*t)},createSocketServer:function(t){var e=this;this.$request.post("/swd/deploy/openSocket").then((function(i){i.data.result&&(e.socket=new WebSocket("ws://152.136.101.31:8001"),e.socket.onopen=function(){e.socketData=[{message:"已连接到应用服务器，正在部署...",time:e.$dateTime()}],t()},e.socket.onmessage=function(t){e.socketData.push({message:t.data,time:e.$dateTime()})})}))}}}),g=v,b=(i("6a5d"),Object(p["a"])(g,w,f,!1,null,"67e90abd",null)),y=b.exports,x={components:{Decorate:o["a"],Gynamic:m,StaticIndex:y},data:function(){return{modeType:"0"}},created:function(){this.modeType=this.$route.query.isStatic?this.$route.query.isStatic:"0"},methods:{handleCharge:function(t){this.modeType=t}}},_=x,k=(i("a8c8"),Object(p["a"])(_,s,a,!1,null,"cd7c4d4e",null));e["default"]=k.exports},"3e6d":function(t,e,i){},"5c23":function(t,e,i){"use strict";i("b7f7")},"5c74":function(t,e,i){"use strict";i("ed3d")},"6a5d":function(t,e,i){"use strict";i("8a79")},8418:function(t,e,i){"use strict";var s=i("c04e"),a=i("9bf2"),o=i("5c6c");t.exports=function(t,e,i){var r=s(e);r in t?a.f(t,r,o(0,i)):t[r]=i}},"8a79":function(t,e,i){},9148:function(t,e,i){},a33d:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{staticClass:"log-box",attrs:{title:"部署日志",scrollable:"",transfer:!1,width:"70%","mask-closable":!1,"footer-hide":!0},model:{value:t.isLogModal,callback:function(e){t.isLogModal=e},expression:"isLogModal"}},[i("div",{ref:"logWarp",staticClass:"log-warp"},[i("ul",t._l(t.socketData,(function(e,s){return i("li",{key:s},[i("span",[t._v("【"+t._s(e.time)+" 】:")]),i("pre",{domProps:{innerHTML:t._s(e.message)}})])})),0)])])},a=[],o=i("20d6"),r=i("f971"),n={components:{Decorate:o["a"],DeployTip:r["a"]},data:function(){return{isLogModal:!1}},props:["socketData"],watch:{socketData:function(){this.isLogModal=!0;var t=this.$refs.logWarp;t.scrollHeight>t.clientHeight&&(t.scrollTop=t.scrollHeight)}}},l=n,c=(i("5c74"),i("2877")),d=Object(c["a"])(l,s,a,!1,null,"b2ba6ab0",null);e["a"]=d.exports},a434:function(t,e,i){"use strict";var s=i("23e7"),a=i("23cb"),o=i("a691"),r=i("50c4"),n=i("7b0b"),l=i("65f0"),c=i("8418"),d=i("1dde"),u=d("splice"),p=Math.max,h=Math.min,m=9007199254740991,w="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!u},{splice:function(t,e){var i,s,d,u,f,v,g=n(this),b=r(g.length),y=a(t,b),x=arguments.length;if(0===x?i=s=0:1===x?(i=0,s=b-y):(i=x-2,s=h(p(o(e),0),b-y)),b+i-s>m)throw TypeError(w);for(d=l(g,s),u=0;u<s;u++)f=y+u,f in g&&c(d,u,g[f]);if(d.length=s,i<s){for(u=y;u<b-s;u++)f=u+s,v=u+i,f in g?g[v]=g[f]:delete g[v];for(u=b;u>b-s+i;u--)delete g[u-1]}else if(i>s)for(u=b-s;u>y;u--)f=u+s-1,v=u+i-1,f in g?g[v]=g[f]:delete g[v];for(u=0;u<i;u++)g[u+y]=arguments[u+2];return g.length=b-s+i,d}})},a640:function(t,e,i){"use strict";var s=i("d039");t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},a8c8:function(t,e,i){"use strict";i("c26a")},b7f7:function(t,e,i){},c26a:function(t,e,i){},d9a0:function(t,e,i){"use strict";i("3e6d")},ed3d:function(t,e,i){},f971:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tip-warp"},[i("h3",[i("Icon",{attrs:{type:"ios-help-circle-outline",size:"18"}}),i("span",{staticClass:"active"},[t._v("关联 Git 仓库")])],1),i("div",{staticClass:"content"},[i("div",[t._v("1、打开git：项目仓库 -> Settings -> Webhooks -> Add webhook")]),i("div",[t._v(" 2、在 "),i("span",{staticClass:"code"},[t._v("Target URL")]),t._v(" 中填入 "),i("span",{staticClass:"url"},[t._v(t._s(t.url)+"/swd/git/webhook")]),t._v(" 地址 ")]),t._m(0),t._m(1),t._m(2),i("div",[i("span",{staticStyle:{color:"red"}},[t._v("注意：")]),t._v("若项代码托管平台为GitHub时，在第 2 步中需要填入 "),i("span",{staticClass:"url"},[t._v(t._s(t.url)+"/api/deploy/git?key="+t._s(t.key?t.key:"返回的key值"))]),t._v(" 地址。 ")])])])},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._v(" 3、 "),i("span",{staticClass:"code"},[t._v("POST Content Type")]),t._v(" 选择 "),i("span",{staticClass:"select"},[t._v("application/json")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._v(" 4、 "),i("span",[t._v(" 在 "),i("span",{staticClass:"code"},[t._v("Secret")]),t._v(" 中填入部署成功后返回的 Key 值。 ")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._v(" 5、 "),i("span",{staticClass:"code"},[t._v("Trigger On")]),t._v("选择 "),i("span",{staticClass:"select"},[t._v("Push Events")])])}],o={data:function(){return{key:"",url:""}},mounted:function(){this.url=window.location.origin},methods:{handleShell:function(){this.$event.emit("isShell",!0)}}},r=o,n=(i("01e1"),i("2877")),l=Object(n["a"])(r,s,a,!1,null,"0899da98",null);e["a"]=l.exports}}]);