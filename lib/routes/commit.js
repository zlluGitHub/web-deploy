const express=require("express"),router=express.Router(),commitSchema=require("../schema/commit");router.get("/get",(p2,res,next)=>{let{pageSize,pageNo,projectId}=p2.query;pageSize=pageSize?+pageSize:10,pageNo=pageNo?+pageNo-1:0;let filter={};projectId&&(filter.projectId=projectId);var p1=new Promise((resolve,reject)=>{commitSchema.find(filter,{_id:0,__v:0},(err,data)=>{err?reject(err):resolve(data)}).skip(pageNo*pageSize).limit(pageSize).sort({_id:-1})}),p2=new Promise((resolve,reject)=>{commitSchema.find(filter).count((err,count)=>{err?reject(err):resolve(count)})});Promise.all([p1,p2]).then(result=>{res.json({message:"获取成功！",data:result[0],count:result[1],code:200})}).catch(error=>{console.log(error),res.json({result:!1,code:500})})}),router.post("/updateInfo",(req,res,next)=>{let body=req.body;commitSchema.updateOne({bid:body.bid},body,(err,data)=>{err?(console.log("错误信息：",err),res.json({message:"日志更新失败！",result:!1,code:500})):res.json({message:"日志更新成功！",data:body.bid,code:200})})}),module.exports=router;