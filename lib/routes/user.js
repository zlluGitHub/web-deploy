const express=require("express"),router=express.Router(),tools=require("../public/javascripts/tools"),email=require("../public/javascripts/email"),user=require("../schema/user");router.post("/login",(body,res,next)=>{body=body.body;user.find({name:body.name,password:body.password},(err,data)=>{err?(console.log("错误信息：",err),res.json({message:"用户信息校验失败！",code:500})):data[0]?res.json({result:!0,data:{name:data[0].name,date:data[0].date,bid:data[0].bid},message:"用户登陆成功！",code:200}):res.json({result:!1,code:200,message:"用户登录失败！"})})}),router.post("/",(req,res,next)=>{let body=req.body;body.bid=body.bid||tools.getUid(),body.date=tools.dateTime(),user.find({name:body.name,password:body.password},(err,data)=>{err?(console.log("错误信息：",err),res.json({message:"用户信息获取失败！",code:500})):data[0]?res.json({result:!1,data:{name:body.name,date:body.date,bid:body.bid},code:200,message:"您已注册，请直接登录！"}):user.create(body,(err,data)=>{err?(console.log("错误信息：",err),res.json({message:"抱歉，注册失败！",code:500})):res.json({result:!0,data:{name:body.name,date:body.date,bid:body.bid},message:"恭喜，注册成功，请登录！",code:200})})})}),router.post("/delete",(bid,res,next)=>{bid=bid.query.bid;user.deleteOne({bid:bid},(err,data)=>err?(console.log("错误信息：",err),void res.json({result:!1,code:500})):void res.json({result:!0,code:200,data:data}))}),router.post("/update",(body,res,next)=>{body=body.body;user.updateOne({bid:body.bid},{$set:body},(err,data)=>{err?(res.json({code:500,message:"信息更新失败！"}),console.log("错误信息：",err)):res.json({code:200,message:"信息更新成功！"})})}),module.exports=router;