const express=require("express"),router=express.Router(),fs=require("fs"),multer=require("multer");let url="./public/images/",upload=multer({dest:url}).single("file");router.post("/",upload,(fileName,res,next)=>{if(0===fileName.file.length)res.json({result:!1,code:500,message:"上传文件不能为空！"});else{var file=fileName.file,fileName=(new Date).getTime()+".jpg";fs.renameSync(url+file.filename,url+fileName);let fileInfo={};fileInfo.name=fileName,fileInfo.size=file.size,fileInfo.path="images/"+fileName,res.json({result:!0,code:200,fileInfo:fileInfo,message:"文件上传成功！"})}}),router.post("/remove",(req,res,next)=>{let body=req.body;body.name?fs.readdirSync(url).map(file=>{body.name===file&&fs.unlink(url+file,err=>{err?(console.log(err),res.json({result:!1,code:500,message:body.name+" 文件删除失败！"})):res.json({result:!0,code:200,message:body.name+" 文件删除成功！"})})}):res.json({result:!1,code:500,message:body.name+" 文件删除失败！"})}),module.exports=router;