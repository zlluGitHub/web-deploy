let ws=require("nodejs-websocket");const PORT=4455;let clientCount=0,server=ws.createServer(function(conn){console.log("New connection"),clientCount++,conn.nickname="user"+clientCount;let mes={type:"enter"};mes.data=conn.nickname+" comes in",broadcast(JSON.stringify(mes)),conn.on("text",function(str){console.log("Received "+str);let mes={type:"message"};mes.data=str,broadcast(JSON.stringify(mes))}),conn.on("close",function(code,reason){console.log("Connection closed");let mes={type:"leave"};mes.data=conn.nickname+" left",broadcast(JSON.stringify(mes))}),conn.on("error",function(err){console.log("handle err"),console.log(err)})}).listen(PORT);function broadcast(str){server.connections.forEach(function(connection){connection.sendText(str)})}console.log("websocket server running on port: "+PORT);