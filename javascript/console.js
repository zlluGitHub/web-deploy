const datetime=require("silly-datetime"),path=require("path"),fs=require("fs-extra"),consolePath="../console",logger=async({type,bid,userId,message,commitBid})=>{type=type||"info";let logPath=path.join(__dirname,consolePath+`/${bid}/${commitBid}.log`),options={flags:"a",encoding:"utf8"};console.log(message),await fs.ensureFile(logPath).then(async()=>{var text=await fs.createWriteStream(logPath,options);let logger=new console.Console(text);text=datetime.format(new Date,"YYYY-MM-DD HH:mm:ss"),text=type+` -wd- ${text} -wd- ${message} -lf-`;await logger.log(text),global.store.ws[userId]&&global.store.ws[userId].sendText(JSON.stringify({type:"info",data:text}))}).catch(err=>{console.error(err)})},info=async obj=>{await logger({...obj,type:"info"})},error=async obj=>{await logger({...obj,type:"error"})},warning=async obj=>{await logger({...obj,type:"warning"})},exec=(body,result)=>new Promise(async(resolve,reject)=>{result.stdout&&await info({...body,message:result.stdout}),0==result.code?(result.stderr&&await info({...body,message:result.stderr}),resolve()):(result.stderr&&await error({...body,message:result.stderr}),reject(result.stderr||"发生未知错误，详情请查看日志！"))});module.exports={info:info,error:error,warning:warning,exec:exec};